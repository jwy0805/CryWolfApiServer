@page
@model AdminModel
@{
    ViewData["Title"] = "Admin";
}

<section class="admin-shell">
    <header class="admin-header">
        <h1>Admin Console</h1>
        <p class="muted">메시지/공지 발송, 대상 선택을 여기서 관리합니다.</p>
    </header>

    <div class="admin-card">
        <div class="field-row">
            <span class="field-label">타입</span>
            <div class="toggle-group" data-message-toggle>
                <button type="button" class="toggle-btn is-active" data-message-type="message">메일</button>
                <button type="button" class="toggle-btn" data-message-type="notice">공지사항</button>
            </div>
        </div>

        <div class="field-row">
            <span class="field-label">대상</span>
            <div class="toggle-group" data-target-toggle>
                <button type="button" class="toggle-btn is-active" data-target-type="all">모두에게</button>
                <button type="button" class="toggle-btn" data-target-type="select">선택</button>
            </div>
        </div>

        <div class="field-row range-inputs" data-range-block hidden>
            <span class="field-label">유저 ID 범위</span>
            <div class="range-form">
                <div class="range-pair">
                    <input type="number" class="range-input" placeholder="예: 1" min="0" data-range-start/>
                    <span class="range-tilde">~</span>
                    <input type="number" class="range-input" placeholder="예: 90" min="0" data-range-end/>
                </div>
                <button type="button" class="btn-add-range" data-add-range>추가</button>
            </div>
            <p class="range-hint muted">예) 1 ~ 90 입력 후 추가 → 다시 101 ~ 140 입력 후 추가</p>
        </div>

        <div class="field-row">
            <span class="field-label">선택된 대상</span>
            <div class="selection-summary" data-selection-summary>모든 유저에게 전송됩니다.</div>
        </div>

        <div class="field-row">
            <span class="field-label">언어</span>
            <div class="toggle-group lang-toggle" data-lang-toggle></div>
            <p class="muted lang-hint">언어 탭을 선택하면 언어별 폼이 생성됩니다. (ko/en/ja/vi 기본, 확장 가능)</p>
        </div>

        <div class="field-row">
            <span class="field-label">언어별 내용</span>
            <div class="lang-form-list" data-lang-forms></div>
        </div>

        <div class="field-row notice-schedule" data-notice-schedule hidden>
            <span class="field-label">공지 기간</span>
            <div class="schedule-grid">
                <label class="schedule-field">
                    <span>Start At</span>
                    <input type="datetime-local" class="admin-input admin-datetime" data-start-at />
                </label>
                <label class="schedule-field">
                    <span>End At</span>
                    <input type="datetime-local" class="admin-input admin-datetime" data-end-at />
                </label>
            </div>
        </div>

        <div class="field-row notice-reward" data-reward-section hidden>
            <span class="field-label">이벤트 보상</span>
            <div class="toggle-group" data-reward-toggle>
                <button type="button" class="toggle-btn is-active" data-reward-mode="off">없음</button>
                <button type="button" class="toggle-btn" data-reward-mode="on">보상 입력</button>
            </div>
            <div class="reward-list" data-reward-block hidden>
                <div class="reward-row" data-reward-row>
                    <label class="reward-field">
                        <span>Product ID</span>
                        <input type="number" class="admin-input" placeholder="예: 12001" min="1" data-reward-product-id />
                    </label>
                    <label class="reward-field">
                        <span>타입</span>
                        <select class="admin-input" data-reward-product-type>
                            <option value="">선택</option>
                            <option value="0">Container</option>
                            <option value="1">Unit</option>
                            <option value="2">Material</option>
                            <option value="3">Enchant</option>
                            <option value="4">Sheep</option>
                            <option value="5">Character</option>
                            <option value="6">Gold</option>
                            <option value="7">Spinel</option>
                            <option value="8">Exp</option>
                            <option value="9">Subscription</option>
                        </select>
                    </label>
                    <label class="reward-field">
                        <span>수량</span>
                        <input type="number" class="admin-input" placeholder="예: 1" min="1" data-reward-count />
                    </label>
                    <button type="button" class="btn-remove-reward" data-remove-reward>삭제</button>
                </div>
                <button type="button" class="btn-add-reward" data-add-reward>보상 추가</button>
            </div>
            <p class="muted reward-hint">보상이 있으면 이벤트 타입으로 저장됩니다.</p>
        </div>

        <div class="actions-row">
            <button type="button" class="btn-send" data-send>전송</button>
            <span class="send-status muted" data-send-status></span>
        </div>
    </div>

    <div class="admin-card event-card" data-event-card>
        <header class="event-header">
            <h2>이벤트 작성</h2>
            <p class="muted">Tier 조건/보상을 입력하면 JSON을 자동 생성합니다.</p>
        </header>

        <div class="field-row">
            <span class="field-label">Event Key</span>
            <input type="text" class="admin-input" placeholder="예: friendly_match_2wins_2026_01" data-event-key />
        </div>

        <div class="field-row">
            <span class="field-label">기간</span>
            <div class="schedule-grid">
                <label class="schedule-field">
                    <span>Start At</span>
                    <input type="datetime-local" class="admin-input admin-datetime" data-event-start-at />
                </label>
                <label class="schedule-field">
                    <span>End At</span>
                    <input type="datetime-local" class="admin-input admin-datetime" data-event-end-at />
                </label>
            </div>
        </div>

        <div class="field-row">
            <span class="field-label">Tier 설정</span>
            <div class="event-tier-list" data-event-tier-list></div>
            <button type="button" class="btn-add-tier" data-add-tier>Tier 추가</button>
            <p class="muted">ConditionJson/RewardJson은 서버 전송 시 자동 직렬화됩니다.</p>
        </div>

        <div class="actions-row">
            <button type="button" class="btn-send" data-event-save>이벤트 저장</button>
            <span class="send-status muted" data-event-status></span>
        </div>
    </div>
</section>

@section Scripts {
    <script src="~/js/admin.js" asp-append-version="true"></script>
}
